<!DOCTYPE html>
<html lang="es">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos</title>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="Luz Collado" content="codedthemes">


    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
        id="main-font-link">

    <link rel="stylesheet" href="tabler-icons.min.css">

    <link rel="stylesheet" href="feather.css">

    <link rel="stylesheet" href="fontawesome.css">

    <link rel="stylesheet" href="material.css">

    <link rel="stylesheet" href="style.css" id="main-style-link">
    <link rel="stylesheet" href="style-preset.css">
    <style>
        .text-dark-blue {
            color: darkblue;
        }

        .btn-dark-blue {
            background-color: darkblue;
            color: white;
            border: none;
            transition: background-color 0.3s ease;

        }

        .btn-dark-red {
            background-color: rgb(180, 13, 13);
            color: white;
            border: none;
            transition: background-color 0.3s ease;

        }

        .btn-dark-red:hover {
            background-color: rgb(148, 15, 15);

        }

        .btn-dark-blue:hover {
            background-color: navy;

        }

        .btn-dark-green {
            background-color: rgb(12, 97, 9);
            color: white;
            border: none;
            transition: background-color 0.3s ease;

        }

        .btn-dark-green:hover {
            background-color: rgb(4, 97, 24);

        }

        .btn-dark-alert {
            background-color: rgb(243, 191, 22);
            color: white;
            border: none;
            transition: background-color 0.3s ease;

        }

        .btn-dark-alert:hover {
            background-color: rgb(197, 165, 20);

        }


        .formulario-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            width: 600px;

            max-height: 80%;

            overflow-y: auto;

        }



        #fondoDesenfocado {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;

        }

        @media only screen and (max-width: 768px) {
            table {
                font-size: 0.8em;
            }

            .form-control {
                font-size: 0.8em;
            }
        }

        @media only screen and (max-width: 480px) {
            table {
                font-size: 0.6em;
            }

            .form-control {
                font-size: 0.6em;
            }
        }

        @media (max-width: 768px) {
            .formulario-container {
                width: 100%;
                padding: 20px;
            }
        }


        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }

            .col-md-6 {
                width: 100%;
            }

            .form-floating {
                width: 100%;
            }

            .form-check {
                width: 100%;
            }
        }


        @media (max-width: 768px) {
            .form-control {
                font-size: 16px;
                padding: 10px;
            }

            .form-label {
                font-size: 16px;
            }
        }

        @media (max-width: 768px) {
            .card-header form {
                flex-direction: column;
            }

            .card-header input[type="search"] {
                width: 100%;
                margin-bottom: 10px;
            }

            .card-header button[type="button"] {
                width: 100%;
                margin-bottom: 10px;
            }
        }

        /* Adjust the font size and padding on small screens */
        @media (max-width: 768px) {
            .card-header input[type="search"] {
                font-size: 16px;
                padding: 10px;
            }

            .card-header button[type="button"] {
                font-size: 16px;
                padding: 10px;
            }
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx-style/0.8.13/xlsx-style.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.1/exceljs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>



</head>
<script>

</script>

<body data-pc-preset="preset-1" data-pc-sidebar-theme="light" data-pc-sidebar-caption="true" data-pc-direction="ltr"
    data-pc-theme="light">

    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>

    <nav class="pc-sidebar">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="home" class="b-brand text-primary">
                    <img src="Designer (7).jpeg" style="width: 90px; height: 90px; border-radius: 5px;" alt="...">
                </a>
            </div>

            <div class="navbar-content">
                <ul class="pc-navbar">
                    <li class="pc-item pc-caption">
                        <label>Dashboard</label>
                        <i class="ti ti-dashboard"></i>
                    </li>
                    <li class="pc-item">
                        <a href="home" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-dashboard"></i></span>
                            <span class="pc-mtext">Sistema</span>
                        </a>
                    </li>
                    <li class="pc-item pc-caption">
                        <label>Empresa</label>
                        <i class="ti ti-dashboard"></i>
                    </li>
                    <li class="pc-item">
                        <a href="info" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-clipboard-list"></i></span>
                            <span class="pc-mtext">Datos</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="employees" class="pc-link" id="empleados">
                            <span class="pc-micon"><i class="ti ti-friends"></i></span>
                            <span class="pc-mtext">Empleados</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="pc-header">
        <div class="header-wrapper">

            <div class="ms-auto">
                <ul class="list-unstyled">
                    <li class="pc-h-item header-mobile-collapse">
                        <a href="#" class="pc-head-link head-link-secondary ms-0" id="sidebar-hide">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <li class="pc-h-item pc-sidebar-popup">
                        <a href="#" class="pc-head-link head-link-secondary ms-0" id="mobile-collapse">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <!-- <li class="dropdown pc-h-item">
                        <a class="pc-head-link head-link-secondary dropdown-toggle arrow-none me-0"
                            data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false"
                            aria-expanded="false">
                            <i class="ti ti-bell"></i>
                        </a>
                        <div class="dropdown-menu dropdown-notification dropdown-menu-end pc-h-dropdown">
                            <div class="dropdown-header">
                                <a href="#!" class="link-primary float-end text-decoration-underline">Mark as all
                                    read</a>
                                <h5>All Notification <span class="badge bg-warning rounded-pill ms-1">01</span></h5>
                            </div>
                            <div class="dropdown-header px-0 text-wrap header-notification-scroll position-relative"
                                style="max-height: calc(100vh - 215px)">
                                <div class="list-group list-group-flush w-100">
                                    <div class="list-group-item list-group-item-action">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0">
                                                <div class="user-avtar bg-light-success"><i
                                                        class="ti ti-building-store"></i></div>
                                            </div>
                                            <div class="flex-grow-1 ms-1">
                                                <span class="float-end text-muted">3 min ago</span>
                                                <h5>Store Verification Done</h5>
                                                <p class="text-body fs-6">We have successfully received your request.
                                                </p>
                                                <div class="badge rounded-pill bg-light-danger">Unread</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="list-group-item list-group-item-action">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0">
                                                <img src="../assets/images/user/avatar-3.jpg" alt="user-image"
                                                    class="user-avtar">
                                            </div>
                                            <div class="flex-grow-1 ms-1">
                                                <span class="float-end text-muted">10 min ago</span>
                                                <h5>Joseph William</h5>
                                                <p class="text-body fs-6">It is a long established fact that a reader
                                                    will be distracted </p>
                                                <div class="badge rounded-pill bg-light-success">Confirmation of Account
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="text-center py-2">
                                <a href="#!" class="link-primary">Mark as all read</a>
                            </div>
                        </div>
                    </li> -->
                    <li class="dropdown pc-h-item header-user-profile">
                        <a class="pc-head-link head-link-primary dropdown-toggle arrow-none me-0"
                            data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false"
                            aria-expanded="false">
                            <img src="Designer (7).jpeg" style="width: 50px; height: 50px; border-radius: 50%;" />
                            <span>
                                <i class="ti ti-settings"></i>
                            </span>
                        </a>
                        <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown">
                            <div class="dropdown-header">
                                <h4>Hola, <span class="small text-muted" id="username"> Name</span></h4>
                                <p class="text-muted" id="role">Rol</p>
                                <hr>
                                <div class="profile-notification-scroll position-relative"
                                    style="max-height: calc(100vh - 280px)">
                                    <hr>
                                    <button id="settingsButton" type="submit" class="dropdown-item">
                                        <i class="ti ti-settings"></i>
                                        <span>Configuración</span>
                                    </button>
                                    <button id="registerButton" type="submit" class="dropdown-item">
                                        <i class="ti ti-user-plus"></i>
                                        <span>Registro</span>
                                    </button>
                                    <button class="dropdown-item" id="signoutbutton">
                                        <i class="ti ti-logout"></i>
                                        <span>Cerrar Sesión</span>
                                    </button>

                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <div class="pc-container">
        <div class="pc-content">

            <div class="row">
                <div class="col">
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="home">Sistema</a></li>
                        <li class="breadcrumb-item" aria-current="page">Productos</li>
                    </ul>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Registro de Productos</h5>
                            <div class="card-header">
                                <a href="#" class="pc-link" id="nuevo" style="margin-right: 10px;">
                                    <span class="pc-micon"><i class="ti ti-crosshair"></i></span>
                                    <span class="pc-mtext">Nuevo</span>
                                </a>
                            </div>
                            <div class="card-header">
                                <form id="MainFormSE" class="d-flex" style="max-width: 400px;">
                                    <input id="searchInput" class="form-control me-sm-2" type="search"
                                        placeholder="Buscar" style="flex: 1 0 auto;">
                                    <!-- <button class="btn btn-dark-blue my-2 my-sm-0" type="submit">Buscar</button> -->
                                    <button id="generatePDFbutton" type="button"
                                        class="btn btn-dark-red fa-solid fa-file-pdf"
                                        style="margin-right: 10px;"></button>
                                    <button id="generateExcelButton" type="button"
                                        class="btn btn-dark-green fa-solid fa-file-excel"></button>

                                </form>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" style="overflow-x: auto;">
                                        <thead>
                                            <tr>
                                                <th scope="col">Descripción</th>
                                                <th scope="col">Disponible</th>
                                                <th scope="col">Precio de compra</th>
                                                <th scope="col">Precio de venta</th>
                                                <th scope="col">Categoría</th>
                                                <th scope="col">ITBIS</th>
                                                <th scope="col">Vencimiento</th>
                                                <th scope="col">Fecha de Entrada</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="nuevoFormulario" class="formulario-container" style="display: none;">
        <h3 class="mb-3">Registrar Productos</h3>
        <form id="MainForm">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="desp" placeholder="Descripción">
                        <label for="desp">*Descripción</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating mb-3" id="disponibleContainer">
                        <input type="text" class="form-control" id="disp" placeholder="Disponible">
                        <label for="disp">*Disponible</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="naDisponibleCheckbox">
                        <label class="form-check-label" for="naDisponibleCheckbox">N/A</label>
                    </div>
                </div>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="moneda" placeholder="Moneda">
                <label for="moneda">*Moneda</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="precio" placeholder="Precio de compra">
                <label for="precio">*Precio de compra</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="precioventa" placeholder="Precio de venta">
                <label for="precio">*Precio de venta</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="categoria" placeholder="Categoría">
                <label for="Categoria">*Categoría</label>
            </div>
            <div class="mb-3">
                <label>*ITBIS</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="itbisCheckbox">
                    <label class="form-check-label" for="itbisCheckbox">ITBIS 18%</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="naCheckbox" checked>
                    <label class="form-check-label" for="naCheckbox">N/A</label>
                </div>
            </div>
            <div class="mb-3">
                <label>*Fecha de Vencimiento</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="establecerFechaCheckbox">
                    <label class="form-check-label" for="establecerFechaCheckbox">Establecer Fecha</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="naCheckboxN" checked>
                    <label class="form-check-label" for="naCheckboxN">N/A</label>
                </div>
                <div class="form-floating mb-3" id="fechaVencimientoContainer" style="display: none;">
                    <input type="date" class="form-control" id="fechaVencimiento" placeholder="Fecha de Vencimiento">
                    <label for="fechaVencimiento">Fecha de Vencimiento</label>
                </div>
            </div>
            <div class="form-floating mb-3">
                <input type="date" class="form-control" id="fechaEntrada" placeholder="Fecha de Vencimiento">
                <label for="fechaEntrada">*Fecha de Entrada</label>
            </div>
            <div class="form-floating mb-3">
                <select class="form-select" id="roleSelect" aria-label="Floating label select example">
                    <option selected>Elige un suplidor</option>
                </select>
                <label for="roleSelect">*Suplidor</label>
            </div>
            <div class="d-grid mt-4">
                <button type="submit" class="btn btn-success" id="updateButton">Registrar datos</button>
            </div>
            <div class="d-grid mt-2">
                <button type="button" class="btn btn-danger" id="closeButton">Cerrar</button>
            </div>
        </form>
    </div>

    <div id="EditarFormulario" class="formulario-container" style="display: none;">
        <h3 class="mb-3">Editar Productos</h3>
        <form id="MainFormE">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="despE" placeholder="Descripción">
                        <label for="floatingInput">*Descripción</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating mb-3" id="disponibleContainer">
                        <input type="text" class="form-control" id="dispE" placeholder="Disponible">
                        <label for="dispE">*Disponible</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="naDisponibleCheckboxE">
                        <label class="form-check-label" for="naDisponibleCheckboxE">N/A</label>
                    </div>
                </div>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="monedaE" placeholder="Moneda">
                <label for="monedaE">*Moneda</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="precioE" placeholder="Precio de compra">
                <label for="precio">*Precio de compra</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="precioventaE" placeholder="Precio de venta">
                <label for="precio">*Precio de venta</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="categoriaE" placeholder="Categoría">
                <label for="categoriaE">*Categoría</label>
            </div>
            <div class="mb-3">
                <label>*ITBIS</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="itbisCheckboxE">
                    <label class="form-check-label" for="itbisCheckboxE">ITBIS 18%</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="naCheckboxIE" checked>
                    <label class="form-check-label" for="naCheckboxIE">N/A</label>
                </div>
            </div>
            <div class="mb-3">
                <label>*Fecha de Vencimiento</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="establecerFechaCheckboxE">
                    <label class="form-check-label" for="establecerFechaCheckboxE">Establecer Fecha</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="naCheckboxE" checked>
                    <label class="form-check-label" for="naCheckboxE">N/A</label>
                </div>
                <div class="form-floating mb-3" id="fechaVencimientoContainerE" style="display: none;">
                    <input type="date" class="form-control" id="fechaVencimientoE" placeholder="Fecha de Vencimiento">
                    <label for="fechaVencimientoE">Fecha de Vencimiento</label>
                </div>
            </div>
            <div class="form-floating mb-3">
                <input type="date" class="form-control" id="fechaEntradaE" placeholder="Fecha de Vencimiento">
                <label for="fechaEntradaE">*Fecha de Entrada</label>
            </div>
            <div class="form-floating mb-3">
                <select class="form-select" id="roleSelectE" aria-label="Floating label select example">
                    <option selected>Elige un suplidor</option>

                </select>
                <label for="roleSelectE">*Suplidor</label>
            </div>
            <div class="d-grid mt-4">
                <button type="submit" class="btn btn-success" id="actuaButton">Registrar
                    datos</button>
            </div>
            <div class="d-grid mt-2">
                <button type="button" class="btn btn-danger" id="closeEButton">Cerrar</button>
            </div>
        </form>
    </div>
    <div id="fondoDesenfocado"></div>
    <footer class="pc-footer">
        <div class="footer-wrapper container-fluid">
            <div class="row">
                <div class="col-sm-6 my-1">
                    <p class="m-0">By: Luz Collado<a target="_blank"></a></p>
                </div>
            </div>
        </div>
    </footer>


    <script type="module">
        window.addEventListener('DOMContentLoaded', () => {
            const userCreds = sessionStorage.getItem("user-creds");

            if (!userCreds && window.location.pathname.includes('productos')) {
                window.location.href = 'login';
                return; // Agrega return para detener la ejecución
            }

            if (userCreds && window.location.pathname.includes('productos')) {
                const UserCreds = JSON.parse(userCreds);
                const userId = UserCreds.uid;

                const dbRef = ref(db);
                get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        const role = userData.roleselect;
                        const roleElement = document.getElementById('role');

                        if (role === 'Asistente') {
                            window.location.href = 'home';
                        } else {
                            // roleElement.textContent = role;
                        }

                    } else {
                        console.log("No data available");
                    }
                }).catch((error) => {
                    console.error(error);
                });
            }
        });

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { getDatabase, set, ref, get, child, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, orderBy, addDoc, query, limit, getDocs, getDoc, doc, setDoc, serverTimestamp, deleteDoc, Timestamp, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, uploadBytesResumable } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";


        const firebaseConfig = {
            apiKey: "AIzaSyCknSaxVHB10B_v-4yD9UtNj1dmZZKVRe4",
            authDomain: "billing-system-fbfb3.firebaseapp.com",
            projectId: "billing-system-fbfb3",
            storageBucket: "billing-system-fbfb3.appspot.com",
            messagingSenderId: "906484441227",
            appId: "1:906484441227:web:7b486131ad930a7b03b48e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth();
        const storage = getStorage(app);

        window.addEventListener('DOMContentLoaded', () => {
            const userCreds = sessionStorage.getItem("user-creds");
            if (!userCreds && window.location.pathname.includes('productos')) {
                window.location.href = 'login';
            }

        });

        document.getElementById('roleSelect').addEventListener('change', function () {
            const exequaturContainer = document.getElementById('exequaturContainer');
            if (this.value === 'Doctor') {
                exequaturContainer.style.display = 'block';
            } else {
                exequaturContainer.style.display = 'none';
            }
        });

        document.getElementById('roleSelectE').addEventListener('change', function () {
            const exequaturContainerE = document.getElementById('exequaturContainerE');
            if (this.value === 'Doctor') {
                exequaturContainerE.style.display = 'block';
            } else {
                exequaturContainerE.style.display = 'none';
            }
        });


        document.addEventListener('DOMContentLoaded', (event) => {
            const disponibleInput = document.getElementById('disp');
            const naDisponibleCheckbox = document.getElementById('naDisponibleCheckbox');

            naDisponibleCheckbox.addEventListener('change', () => {
                if (naDisponibleCheckbox.checked) {
                    disponibleInput.disabled = true; // Deshabilitar el campo
                    disponibleInput.value = ''; // Opcional: Limpiar el valor del campo si se deshabilita
                } else {
                    disponibleInput.disabled = false; // Habilitar el campo
                }
            });
        });



        const generatePdfButton = document.getElementById('generatePDFbutton');
        const generateExcelButton = document.getElementById('generateExcelButton');

        const form = document.getElementById('MainForm');
        const formE = document.getElementById('MainFormE');
        const formSE = document.getElementById('MainFormSE');

        const usernameElement = document.getElementById('username');
        const roleElement = document.getElementById('role');
        const registerButton = document.getElementById('registerButton');
        const settingsButton = document.getElementById('settingsButton');
        const nuevoFormulario = document.getElementById('nuevoFormulario');
        const Nuevo = document.getElementById('nuevo');
        const Editar = document.getElementById('editar');
        const fondoDesenfocado = document.getElementById('fondoDesenfocado');
        const closeButton = document.getElementById('closeButton');
        const closeEButton = document.getElementById('closeEButton');


        const desp = document.getElementById('desp');
        const dip = document.getElementById('disp');
        const precio = document.getElementById('precio');
        const categoria = document.getElementById('categoria');
        const fechaVencimiento = document.getElementById('fechaVencimiento');
        const fechaEntrada = document.getElementById('fechaEntrada');

        const despE = document.getElementById('despE');
        const dipE = document.getElementById('dispE');
        const precioE = document.getElementById('precioE');
        const categoriaE = document.getElementById('categoriaE');
        const fechaVencimientoE = document.getElementById('fechaVencimientoE');
        const fechaEntradaE = document.getElementById('fechaEntradaE');

        const Moneda = document.getElementById('moneda');
        const MonedaE = document.getElementById('monedaE');


        const EditarFormulario = document.getElementById('EditarFormulario');
        const actuButton = document.getElementById('actuButton');

        const precioventa = document.getElementById('precioventa');
        const precioventaE = document.getElementById('precioventaE');

        function toggleFormulario() {
            if (nuevoFormulario.style.display === 'none') {
                nuevoFormulario.style.display = 'block';
                fondoDesenfocado.style.display = 'block';
            } else {
                nuevoFormulario.style.display = 'none';
                fondoDesenfocado.style.display = 'none';
            }
        }

        function toggleFormularioE() {
            if (EditarFormulario.style.display === 'none' || EditarFormulario.style.display === '') {
                EditarFormulario.style.display = 'block';
                fondoDesenfocado.style.display = 'block';
            } else {
                EditarFormulario.style.display = 'none';
                fondoDesenfocado.style.display = 'none';
            }
        }

        let currentUserRole = '';

        function showUserData(userId) {
            const dbRef = ref(db);
            get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    usernameElement.textContent = `${userData.firstname} ${userData.lastname}`;
                    roleElement.textContent = userData.roleselect;

                    if (userData.roleselect === 'Asistente') {
                        registerButton.disabled = true;
                    }
                    currentUserRole = userData.roleselect;

                    // Cargar los suplidores después de obtener el rol del usuario
                    loadProductos();
                } else {
                    console.log("No data available");
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        function showUserData2(userId) {
            const dbRef = ref(db);
            get(child(dbRef, `UsersAuthList/${userId}`)).then((snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    usernameElement.textContent = `${userData.firstname} ${userData.lastname}`;
                    roleElement.textContent = userData.roleselect;

                    if (userData.roleselect === 'Administrador de Almacén') {
                        registerButton.disabled = true;
                        document.getElementById('empleados').addEventListener('click', function (event) {
                            event.preventDefault();
                        });
                    }
                } else {
                    console.log("No data available");
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                showUserData(user.uid);
                showUserData2(user.uid);
            } else {
                console.log("User is not signed in");
            }
        });

        let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));
        let UserName = JSON.parse(sessionStorage.getItem("username"));
        let Role = JSON.parse(sessionStorage.getItem("role"));
        let MainForm = document.getElementById('MainForm');
        let MainFormE = document.getElementById('MainFormE');
        let MainFormSE = document.getElementById('MainFormSE');

        let SignoutBtn = document.getElementById('signoutbutton');

        let Signout = () => {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");

            window.location.href = 'login';
        }

        let CheckCred = () => {
            if (!sessionStorage.getItem("user-creds"))
                window.location.href = 'login';
            else {
                UserName.innerText = ` ${UserName.firstname}`
                Role.innerText = ` ${UserName.roleselect}`
            }
        }

        document.getElementById('registerButton').addEventListener('click', () => {
            window.location.href = 'register';
        });

        document.getElementById('settingsButton').addEventListener('click', () => {
            window.location.href = 'settings';
        });

        closeButton.addEventListener('click', function () {
            nuevoFormulario.style.display = 'none';
            fondoDesenfocado.style.display = 'none';

            document.getElementById('desp').value = '';
            document.getElementById('disp').value = '';
            document.getElementById('precio').value = '';
            document.getElementById('precioventa').value = '';
            document.getElementById('categoria').value = '';
            document.getElementById('roleSelect').selectedIndex = 0;
            document.getElementById('fechaVencimiento').value = '';
            document.getElementById('fechaEntrada').value = '';
            document.getElementById('establecerFechaCheckbox').checked = false;
            document.getElementById('naCheckbox').checked = false;
            document.getElementById('naCheckboxN').checked = false;
        });

        closeEButton.addEventListener('click', function () {
            EditarFormulario.style.display = 'none';
            fondoDesenfocado.style.display = 'none';

            document.getElementById('despE').value = '';
            document.getElementById('dispE').value = '';
            document.getElementById('precioE').value = '';
            document.getElementById('precioventaE').value = '';
            document.getElementById('categoriaE').value = '';
            document.getElementById('roleSelectE').selectedIndex = 0;
            document.getElementById('fechaVencimientoE').value = '';
            document.getElementById('fechaEntradaE').value = '';
            document.getElementById('establecerFechaCheckboxE').checked = false;
            document.getElementById('naCheckboxE').checked = false;
            document.getElementById('naCheckboxIE').checked = false;
        });


        function validatePhoneNumber(event) {
            const input = event.target;
            const inputValue = input.value;

            const numericValue = inputValue.replace(/\D/g, '');
            const trimmedValue = numericValue.slice(0, 10);
            input.value = trimmedValue;
        }

        const phoneNumberInput = document.getElementById('precio');
        phoneNumberInput.addEventListener('input', validatePhoneNumber);
        disp.addEventListener('input', validatePhoneNumber);

        dispE.addEventListener('input', validatePhoneNumber);
        precioE.addEventListener('input', validatePhoneNumber);

        // desp.addEventListener('input', () => {
        //     let inputValue = desp.value;

        //     inputValue = inputValue.replace(/[^A-Za-zÀ-ÿ\s]/g, '');

        //     desp.value = inputValue;
        // });

        // despE.addEventListener('input', () => {
        //     let inputValue = despE.value;

        //     inputValue = inputValue.replace(/[^A-Za-zÀ-ÿ\s]/g, '');

        //     despE.value = inputValue;
        // });

        categoria.addEventListener('input', () => {
            let inputValue = categoria.value;

            inputValue = inputValue.replace(/[^A-Za-zÀ-ÿ\s]/g, '');

            categoria.value = inputValue;
        });

        categoriaE.addEventListener('input', () => {
            let inputValue = categoriaE.value;

            inputValue = inputValue.replace(/[^A-Za-zÀ-ÿ\s]/g, '');

            categoriaE.value = inputValue;
        });


        Nuevo.addEventListener('click', toggleFormulario);

        SignoutBtn.addEventListener('click', Signout);


        async function loadSuppliers() {
            const roleSelect = document.getElementById('roleSelect');
            roleSelect.innerHTML = '<option selected>Elige un suplidor</option>';


            const suppliersSnapshot = await getDocs(collection(getFirestore(), 'suplidores'));


            suppliersSnapshot.forEach((doc) => {
                const supplierData = doc.data();
                const option = document.createElement('option');
                option.value = doc.id;
                option.textContent = supplierData.nombre;
                roleSelect.appendChild(option);
            });
        }


        window.addEventListener('DOMContentLoaded', () => {
            loadSuppliers().catch(error => console.error('Error al cargar suplidores:', error));
        });

        async function loadSuppliersE() {
            const roleSelectE = document.getElementById('roleSelectE');
            roleSelectE.innerHTML = '<option selected>Elige un suplidor</option>';


            const suppliersSnapshot = await getDocs(collection(getFirestore(), 'suplidores'));


            suppliersSnapshot.forEach((doc) => {
                const supplierData = doc.data();
                const option = document.createElement('option');
                option.value = doc.id;
                option.textContent = supplierData.nombre;
                roleSelectE.appendChild(option);
            });
        }


        window.addEventListener('DOMContentLoaded', () => {
            loadSuppliersE().catch(error => console.error('Error al cargar suplidores:', error));
        });


        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('MainForm');
            const fechaVencimiento = document.getElementById('fechaVencimiento');
            const naDisponibleCheckbox = document.getElementById('naDisponibleCheckbox');
            const fechaEntrada = document.getElementById('fechaEntrada');
            const establecerFechaCheckbox = document.getElementById('establecerFechaCheckbox');
            const naCheckbox = document.getElementById('naCheckbox');
            const fechaVencimientoContainer = document.getElementById('fechaVencimientoContainer');
            const naCheckboxN = document.getElementById('naCheckboxN');
            const precioInput = document.getElementById('precio');
            const precioVentaInput = document.getElementById('precioventa');


            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const todayDate = `${yyyy}-${mm}-${dd}`;
            fechaVencimiento.setAttribute('min', todayDate);

            establecerFechaCheckbox.addEventListener('change', () => {
                if (establecerFechaCheckbox.checked) {
                    naCheckbox.checked = false;
                    fechaVencimientoContainer.style.display = 'block';
                } else {
                    fechaVencimientoContainer.style.display = 'none';
                    fechaVencimiento.value = '';
                }
            });

            naCheckbox.addEventListener('change', () => {

                if (naCheckbox.checked) {

                    const itbisValue = document.getElementById('itbisCheckbox').checked ? '18%' : 'N/A';

                    if (itbisValue !== 'N/A') {
                        establecerFechaCheckbox.checked = false;
                        fechaVencimientoContainer.style.display = 'none';
                        fechaVencimiento.value = '';
                    }
                }
            });

            naCheckboxN.addEventListener('change', () => {
                if (naCheckboxN.checked) {
                    establecerFechaCheckbox.checked = false;
                    fechaVencimientoContainer.style.display = 'none';
                    fechaVencimiento.value = '';
                }
            });

            naDisponibleCheckbox.addEventListener('change', () => {
                if (naDisponibleCheckbox.checked) {
                    disp.disabled = true; // Deshabilitar el campo
                    disp.value = 'N/A'; // Establecer el valor a 'N/A'
                } else {
                    disp.disabled = false; // Habilitar el campo
                    disp.value = ''; // Limpiar el valor del campo
                }
            });

            precioInput.addEventListener('input', () => {
                const precio = parseFloat(precioInput.value.trim());

                if (!isNaN(precio)) {
                    // Calcular el 40% del precio y sumarlo al precio original
                    const precioVenta = precio + (precio * 0.4); // 40% de incremento

                    // Actualizar el campo de precioVenta con el resultado formateado
                    precioVentaInput.value = precioVenta.toFixed(2); // Asegurar dos decimales
                } else {
                    precioVentaInput.value = ''; // Limpiar el campo si el precio no es válido
                }
            });


            async function registerProduct() {
                const description = document.getElementById('desp').value;
                const available = naDisponibleCheckbox.checked ? 'N/A' : document.getElementById('disp').value;
                const price = parseFloat(precioInput.value.trim());
                const precioventa = parseFloat(precioVentaInput.value.trim());
                const type = document.getElementById('categoria').value;
                const supplierId = document.getElementById('roleSelect').value;
                const entryDate = fechaEntrada.value;
                const itbis = document.getElementById('itbisCheckbox').checked ? '18%' : 'N/A';
                const Moneda = document.getElementById('moneda').value;

                if (description.trim() === '' || available.trim() === '' || Moneda.trim() === '' || entryDate.trim() === '' || isNaN(price) || isNaN(precioventa)) {
                    showAlert('Por favor complete todos los campos obligatorios.', 'alert-warning');
                    return;
                }

                let formattedExpirationDate = 'N/A';
                if (establecerFechaCheckbox.checked) {
                    const expirationDate = fechaVencimiento.value;
                    if (expirationDate.trim() === '') {
                        showAlert('Por favor establezca una fecha de vencimiento válida.', 'alert-warning');
                        return;
                    }
                    formattedExpirationDate = formatToSpanishDate(expirationDate);
                }

                const formattedEntryDate = formatToSpanishDate(entryDate);

                const productData = {
                    descripcion: description,
                    disponible: available,
                    moneda: Moneda,
                    precio: price,
                    precioVenta: precioventa,
                    categoria: type,
                    suplidorId: supplierId,
                    fechaVencimiento: formattedExpirationDate,
                    fechaEntrada: formattedEntryDate,
                    itbis: itbis
                };

                try {
                    await addDoc(collection(getFirestore(), 'productos'), productData);
                    showAlert('Producto registrado correctamente!', 'alert-success');
                    resetForm();
                } catch (error) {
                    console.error('Error al registrar el producto:', error);
                }
            }

            const formatToSpanishDate = (dateString) => {
                const dateParts = dateString.split('-');
                return `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
            };

            form.addEventListener('submit', (event) => {
                event.preventDefault();
                registerProduct();
            });

            function resetForm() {
                form.reset();
                fechaVencimientoContainer.style.display = 'none';
                naDisponibleCheckbox.checked = true;
                disp.disabled = true; // Mantener el campo deshabilitado
                disp.value = 'N/A'; // Mantener el valor a 'N/A'
            }
        });


        searchInput.addEventListener('input', filterTable)

        const tableBody = document.querySelector('tbody');

        async function loadProductos() {
            tableBody.innerHTML = '';
            const establecerFechaCheckboxE = document.getElementById('establecerFechaCheckboxE');
            const naCheckboxE = document.getElementById('naCheckboxE');
            const fechaVencimientoContainerE = document.getElementById('fechaVencimientoContainerE');
            const naCheckboxIE = document.getElementById('naCheckboxIE');
            const itbisCheckboxE = document.getElementById('itbisCheckboxE');
            const naDisponibleCheckboxE = document.getElementById('naDisponibleCheckboxE');
            const precioventaE = document.getElementById('precioventaE');
            const precioInputE = document.getElementById('precioE');
            const precioVentaInputE = document.getElementById('precioventaE');
            const MonedaE = document.getElementById('monedaE');

            precioInputE.addEventListener('input', () => {
                const precio = parseFloat(precioInputE.value.trim());

                if (!isNaN(precio)) {

                    const precioVenta = precio + (precio * 0.4);


                    precioVentaInputE.value = precioVenta.toFixed(2);
                } else {
                    precioVentaInputE.value = '';
                }
            });

            const suplidoresSnapshot = await getDocs(collection(getFirestore(), 'productos'));

            suplidoresSnapshot.forEach((doc) => {
                const suplidorData = doc.data();
                const { descripcion, disponible, fechaVencimiento, precio, suplidorId, categoria, fechaEntrada, itbis, precioVenta, moneda } = suplidorData;

                let formattedFechaVencimiento = '';
                if (fechaVencimiento !== 'N/A') {
                    const dateParts = fechaVencimiento.split('/');
                    formattedFechaVencimiento = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
                }

                const datePartsE = fechaEntrada.split('/');
                const formattedfechaEntradaE = `${datePartsE[2]}-${datePartsE[1]}-${datePartsE[0]}`;

                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${descripcion}</td>
            <td>${disponible}</td>
            <td>${moneda} ${precio}</td>
            <td>${moneda} ${precioVenta}</td>
            <td>${categoria}</td>
            <td>${itbis}</td>
            <td>${fechaVencimiento}</td>
            <td>${fechaEntrada}</td>
            <td>
                <button class="btn btn-danger btn-sm delete-btn" data-id="${doc.id}" ${currentUserRole === 'Asistente' ? 'disabled' : ''}>
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        `;

                row.addEventListener('dblclick', () => {
                    despE.value = descripcion;
                    dispE.value = disponible;
                    precioE.value = precio;
                    MonedaE.value = moneda;
                    precioventaE.value = precioVenta;
                    categoriaE.value = categoria;
                    fechaVencimientoE.value = formattedFechaVencimiento;
                    fechaEntradaE.value = formattedfechaEntradaE;
                    roleSelectE.value = suplidorId;

                    if (itbis === '18%') {
                        document.getElementById('itbisCheckboxE').checked = true;
                        document.getElementById('naCheckboxIE').checked = false; // Desmarcar N/A si el ITBIS no es N/A
                    } else {
                        document.getElementById('naCheckboxIE').checked = true;
                        document.getElementById('itbisCheckboxE').checked = false;
                    }

                    if (fechaVencimiento === 'N/A') {
                        fechaVencimientoE.value = '';
                        establecerFechaCheckboxE.checked = false;
                        fechaVencimientoContainerE.style.display = 'none';
                        naCheckboxE.checked = true;
                    } else {
                        fechaVencimientoE.value = formattedFechaVencimiento;
                        establecerFechaCheckboxE.checked = true;
                        fechaVencimientoContainerE.style.display = 'block';
                        naCheckboxE.checked = false;
                    }

                    if (disponible === 'N/A') {
                        naDisponibleCheckboxE.checked = true;
                        dispE.disabled = true;
                        dispE.value = '';
                    } else {
                        naDisponibleCheckboxE.checked = false;
                        dispE.disabled = false;
                    }

                    naDisponibleCheckboxE.addEventListener('change', () => {
                        if (naDisponibleCheckboxE.checked) {
                            dispE.disabled = true;
                            dispE.value = '';
                        } else {
                            dispE.disabled = false;
                        }
                    });

                    EditarFormulario.dataset.docId = doc.id;
                    toggleFormularioE();
                });

                tableBody.appendChild(row);
            });

            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const docId = button.dataset.id;

                    showAlert('¿Estás seguro de que deseas eliminar este producto?', 'alert-warning', true, async () => {
                        try {
                            await deleteDoc(doc(getFirestore(), 'productos', docId));
                            showAlert('Producto eliminado correctamente', 'alert-success');
                            loadProductos();
                        } catch (error) {
                            console.error('Error al eliminar el producto:', error);
                        }
                    });
                });
            });
        }

        function showAlert(message, alertType, isConfirmation = false, onConfirm = null) {
            const alertDiv = document.createElement('div');
            alertDiv.classList.add('alert', 'alert-dismissible', alertType, 'position-fixed', 'top-50', 'start-50', 'translate-middle');

            if (isConfirmation) {
                alertDiv.innerHTML = `
            <h4 class="alert-heading">¡Advertencia!</h4>
            <p class="mb-0">${message}</p>
            <div class="mt-2 d-flex justify-content-end">
                <button type="button" class="btn btn-dark-alert me-2" id="confirmYes">Sí</button>
                <button type="button" class="btn btn-dark-alert" id="confirmNo">No</button>
            </div>
        `;
                document.body.appendChild(alertDiv);

                const confirmYes = document.getElementById('confirmYes');
                const confirmNo = document.getElementById('confirmNo');

                confirmYes.addEventListener('click', () => {
                    if (onConfirm) onConfirm();
                    alertDiv.remove();
                });

                confirmNo.addEventListener('click', () => {
                    alertDiv.remove();
                });
            } else {
                alertDiv.innerHTML = `
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <h4 class="alert-heading">¡Advertencia!</h4>
            <p class="mb-0">${message}</p>
        `;

                const formContainer = document.getElementById('nuevoFormulario');
                formContainer.appendChild(alertDiv);

                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        }


        document.addEventListener('DOMContentLoaded', function () {
            const fechaVencimientoInput = document.getElementById('fechaVencimientoE');
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const todayDate = `${yyyy}-${mm}-${dd}`;
            fechaVencimientoInput.setAttribute('min', todayDate);
        });


        document.addEventListener('DOMContentLoaded', function () {
            const formE = document.getElementById('MainFormE');
            const fechaVencimientoE = document.getElementById('fechaVencimientoE');
            const fechaEntradaE = document.getElementById('fechaEntradaE');
            const establecerFechaCheckbox = document.getElementById('establecerFechaCheckboxE');
            const naCheckbox = document.getElementById('naCheckboxE');
            const fechaVencimientoContainer = document.getElementById('fechaVencimientoContainerE');
            const naCheckboxIE = document.getElementById('naCheckboxIE');
            const precioventaE = document.getElementById('precioventaE');


            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Meses empiezan en 0
            const dd = String(today.getDate()).padStart(2, '0');
            const todayDate = `${yyyy}-${mm}-${dd}`;
            fechaVencimientoE.setAttribute('min', todayDate);

            establecerFechaCheckbox.addEventListener('change', () => {
                if (establecerFechaCheckbox.checked) {
                    naCheckbox.checked = false;
                    fechaVencimientoContainer.style.display = 'block';
                } else {
                    fechaVencimientoContainer.style.display = 'none';
                    fechaVencimientoE.value = '';
                }
            });

            naCheckbox.addEventListener('change', () => {

                if (naCheckbox.checked) {

                    const itbisValue = document.getElementById('itbisCheckbox').checked ? '18%' : 'N/A';

                    if (itbisValue !== 'N/A') {
                        establecerFechaCheckbox.checked = false;
                        fechaVencimientoContainer.style.display = 'none';
                        fechaVencimiento.value = '';
                    }
                }
            });

            async function saveChanges() {
                const docId = EditarFormulario.dataset.docId;
                if (!docId) return;

                const description = document.getElementById('despE').value;
                const available = naDisponibleCheckboxE.checked ? 'N/A' : document.getElementById('dispE').value;
                const price = document.getElementById('precioE').value;
                const precioventaE = document.getElementById('precioventaE').value;
                const type = document.getElementById('categoriaE').value;
                const supplierId = document.getElementById('roleSelectE').value;
                const expirationDate = fechaVencimientoE.value;
                const entryDate = fechaEntradaE.value;
                const itbis = document.getElementById('itbisCheckboxE').checked ? '18%' : 'N/A';
                const Moneda = document.getElementById('monedaE').value;

                if (description.trim() === '' || available.trim() === '' || Moneda.trim() === '' || price.trim() === '' || entryDate.trim() === '' || precioventaE.trim() === '') {
                    showAlert('Por favor complete todos los campos obligatorios.', 'alert-warning');
                    return;
                }

                const formatToSpanishDate = (dateString) => {
                    const dateParts = dateString.split('-');
                    return `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
                };

                let formattedExpirationDateE = 'N/A';
                if (establecerFechaCheckbox.checked) {
                    const expirationDate = fechaVencimientoE.value;
                    if (expirationDate.trim() === '') {
                        showAlert('Por favor establezca una fecha de vencimiento válida.', 'alert-warning');
                        return;
                    }
                    formattedExpirationDateE = formatToSpanishDate(expirationDate);
                }

                const formattedEntryDate = formatToSpanishDate(entryDate);

                const updatedData = {
                    descripcion: description,
                    disponible: available,
                    moneda: Moneda,
                    precio: price,
                    precioVenta: precioventaE,
                    categoria: type,
                    suplidorId: supplierId,
                    fechaVencimiento: formattedExpirationDateE,
                    fechaEntrada: formattedEntryDate,
                    itbis: itbis
                };

                try {
                    await setDoc(doc(getFirestore(), 'productos', docId), updatedData);
                    showSuccessAlert('Producto actualizado correctamente');
                    EditarFormulario.style.display = 'none';
                    loadProductos();
                } catch (error) {
                    console.error('Error actualizando documento: ', error);
                }
            }

            formE.addEventListener('submit', function (event) {
                event.preventDefault();
                toggleFormularioE();
                saveChanges();
            });
        });


        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const rows = tableBody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let match = false;

                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].innerText.toLowerCase().includes(searchTerm)) {
                        match = true;
                        break;
                    }
                }

                if (match) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }


        function showSuccessAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.classList.add('alert', 'alert-dismissible', 'alert-success', 'position-fixed', 'top-50', 'start-50', 'translate-middle');
            alertDiv.innerHTML = `
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <strong>¡Bien hecho!</strong> ${message}
        `;
            const formContainer = document.getElementById('nuevoFormulario');
            formContainer.appendChild(alertDiv);
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        function resetForm() {
            document.getElementById('MainForm').reset();
        }

        document.getElementById('generatePDFbutton').addEventListener('click', async (event) => {
            event.preventDefault();

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();


                const logoImage = new Image();
                logoImage.src = 'unoin.png';

                logoImage.onload = async () => {

                    const logoWidth = 20;
                    const logoHeight = (logoWidth / logoImage.width) * logoImage.height;
                    const marginRight = 15;
                    const marginTop = 5;
                    doc.addImage(logoImage, 'PNG', doc.internal.pageSize.width - logoWidth - marginRight, marginTop, logoWidth, logoHeight);

                    doc.setFontSize(20);
                    doc.text('Registro de Productos', 15, 10);

                    const empresaSnapshot = await get(ref(db, 'datos/'));
                    const empresaData = empresaSnapshot.val();

                    if (empresaData) {
                        doc.setFontSize(12);
                        doc.text(`${empresaData.name}`, 15, 20);
                        doc.text(`RNC: ${empresaData.rnc}`, 15, 25);
                        doc.text(`Teléfono: ${empresaData.number}`, 15, 30);


                        const location = empresaData.location;
                        if (location.length > 15) {
                            const firstLine = location.substring(0, 23);
                            let secondLine = location.substring(23);
                            if (secondLine.length > 35) {
                                const secondLineFirstPart = secondLine.substring(0, 35);
                                const secondLineSecondPart = secondLine.substring(35);
                                secondLine = secondLineFirstPart + '\n' + secondLineSecondPart;
                            }
                            doc.text(`Dirección: ${firstLine}`, 15, 35);
                            doc.text(`${secondLine}`, 15, 40);
                        } else {
                            doc.text(`Dirección: ${empresaData.location}`, 15, 35);
                        }
                    }
                    doc.autoTable({
                        head: [['Descripción', 'Disponible', 'Precio', 'Categoría', 'ITBIS', 'Vencimiento', 'Fecha de Entrada']],
                        body: Array.from(tableBody.querySelectorAll('tr')).map(row =>
                            Array.from(row.querySelectorAll('td')).map(cell => cell.innerText)
                        ),
                        startY: 50
                    });

                    const pdfBlob = await doc.output('blob');
                    saveAs(pdfBlob, 'productos.pdf');

                    // doc.save('empleados.pdf');
                };
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                showAlert('Error al generar el PDF', 'alert-danger');
            }
        });

        document.getElementById('generateExcelButton').addEventListener('click', async (event) => {
            event.preventDefault();

            try {
                // Crear una nueva instancia de workbook (libro de Excel)
                const workbook = new ExcelJS.Workbook();

                // Agregar una nueva hoja al libro
                const worksheet = workbook.addWorksheet('Registro de Productos');

                // Establecer estilos para el encabezado
                const headerStyle = {
                    font: { bold: true, color: { argb: 'FFFFFF' } },
                    alignment: { vertical: 'middle', horizontal: 'center' },
                    border: { top: { style: 'thin' }, bottom: { style: 'thin' } },
                    fill: { type: 'pattern', pattern: 'solid', fgColor: { argb: '0074D9' } }
                };

                // Obtener datos de la empresa
                const empresaData = await getEmpresaData();

                if (!empresaData) {
                    throw new Error('No se encontraron datos de la empresa.');
                }

                // Agregar datos de la empresa al inicio del archivo
                worksheet.addRow(['Nombre', empresaData.name]);
                worksheet.addRow(['RNC', empresaData.rnc]);
                worksheet.addRow(['Teléfono', empresaData.number]);
                worksheet.addRow(['Dirección', empresaData.location]);

                // Espacio en blanco entre empresa y tabla de productos
                worksheet.addRow([]);

                // Encabezado de la tabla de productos
                const headerRow = worksheet.addRow([
                    'Descripción',
                    'Disponible',
                    'Precio de compra',
                    'Precio de venta',
                    'Categoría',
                    'ITBIS',
                    'Vencimiento',
                    'Fecha de Entrada'
                ]);

                // Aplicar estilo al encabezado
                headerRow.eachCell((cell) => {
                    cell.style = headerStyle;
                });

                // Agregar datos de la tabla de productos
                const tableRows = await getTableRows();
                tableRows.forEach((row) => {
                    const rowData = [];
                    row.querySelectorAll('td').forEach((cell) => {
                        rowData.push(cell.innerText);
                    });
                    worksheet.addRow(rowData);
                });

                // Establecer anchos de columna automático
                worksheet.columns.forEach((column) => {
                    let maxWidth = 0;
                    column.eachCell({ includeEmpty: true }, (cell) => {
                        const cellLength = cell.value ? cell.value.toString().length : 10;
                        maxWidth = Math.max(maxWidth, cellLength);
                    });
                    column.width = maxWidth < 20 ? 20 : maxWidth;
                });

                // Guardar el archivo Excel
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });

                // Descargar el archivo Excel
                saveAs(blob, 'productos.xlsx');

                // Mostrar mensaje de éxito
                showAlertExcel('Archivo de Excel generado correctamente.', 'alert-success');
            } catch (error) {
                console.error('Error al generar el archivo de Excel:', error);
                showAlertExcel(`Error al generar el archivo de Excel: ${error.message}`, 'alert-danger');
            }
        });

        // Función para obtener datos de la empresa desde Firestore
        async function getEmpresaData() {
            const empresaSnapshot = await get(ref(db, 'datos/'));
            return empresaSnapshot.val();
        }

        // Función para obtener filas de la tabla desde el DOM
        async function getTableRows() {
            const tableBody = document.querySelector('tbody');
            if (!tableBody) {
                throw new Error('No se encontró el cuerpo de la tabla.');
            }
            return Array.from(tableBody.querySelectorAll('tr'));
        }

        function showAlertExcel(message, alertType) {
            const alertBox = document.createElement('div');
            alertBox.className = `alert ${alertType}`;
            alertBox.textContent = message;
            document.body.appendChild(alertBox);
            setTimeout(() => {
                alertBox.remove();
            }, 3000);
        }

    </script>

    <script src="popper.min.js"></script>
    <script src="simplebar.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script src="custom-font.js"></script>
    <script src="pcoded.js"></script>
    <script src="feather.min.js"></script>





    <script>layout_change('light');</script>




    <script>font_change("Roboto");</script>


    <script>change_box_container('false');</script>


    <script>layout_caption_change('true');</script>




    <script>layout_rtl_change('false');</script>


    <script>preset_change("preset-1");</script>


</body>


</html>